# given a string which composed from characters "(" and ")".
# Find the lengthof the longest valid substring.
# https://www.geeksforgeeks.org/length-of-the-longest-valid-substring/

# ---------------------------------------------
def max_valid_len_stack(ss):
    """
    # Using stack to store the index just before a "valid" substring
    # and index of opening parentheses
    # O(N) for time and O(N) for space
    """
    nn = len(ss)
    max_len = 0
    st = []                    # stack
    st.append(-1)              # idx "before"
    for ii in range(nn):
        if ss[ii] == '(':
            st.append(ii)
        else:                  # ')'
            st.pop()
            if len(st) > 0:
                new_len = ii - st[len(st)-1]
                max_len = max(max_len, new_len)
            else:
                st.append(ii)  # idx "before"


    return max_len


# ---------------------------------------------
def max_valid_len(ss):
    """
    # explicit counting of parentheses. No stack.
    # O(N) for time and O(1) for space
    """
    left    = 0
    right   = 0
    max_len = 0
    pre_len = 0
    # -----
    for ch in ss:
        if ch == "(":
            left += 1
        elif ch == ")":
            right += 1 
            if right == left:
                new_len = pre_len + right * 2
                if  max_len < new_len:
                    max_len = new_len
                pre_len = new_len
            elif right > left:
                pre_len = 0
            if right >= left:
                right = 0
                left  = 0
    # -----
    if (left > right) and (right*2 > max_len):
        max_len = right*2


    return max_len


# ---------------------------------------------
tests = [
  ( '', 0),
  ( '(', 0),
  ( ')', 0),
  ( '((', 0),
  ( '))', 0),
  ( '()', 2),
  ( '()()', 4),
  ('((()))', 6),
  ( '()(((',   2),
  ( '())))',   2),
  ( ')))()',   2),
  ( '(((()()', 4),
  ( '))))(()()', 4),
  ( '()(((((()', 2),
  ( '())))))()', 2),
  ( '(((()()()(((()()()()))))', 22),
  ( '()()()((())))))))(()()()()(((()()()())()))', 24),
  ( '(()()()()(((()()()())()))', 24),
  ]


# ---------------------------------------------
for tt in tests :
    ss  = tt[0]
    val = tt[1]


    print("------- max_valid_len_stack")
    result = max_valid_len_stack(ss)
    ok = result == val
    if not ok:
        print(ss, "\n", val, result, ok)


    print("------- max_valid_len")
    result = max_valid_len(ss)
    ok = result == val
    if not ok:
        print(ss, "\n", val, result, ok)